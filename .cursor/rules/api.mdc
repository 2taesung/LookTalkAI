---
description: API 통신 관련 작업(데이터 조회, 생성, 수정, 삭제)을 구현하거나 분석할 때 반드시 이 규칙을 참고하세요.
globs: 
alwaysApply: false
---
# API 호출 규칙

## 기본 원칙
- API 호출 함수는 항상 별도로 정의하고 재사용
- 함수명은 HTTP 메서드를 접두어로 사용 (get, post, put, delete 등)
- **useSuspenseQuery 사용을 우선적으로 고려 (성능상 이점)**
- **API 함수명은 명확하고 일관된 패턴 준수**
- API 응답은 항상 `SHARED_UTILS.api.checkApiResponse`로 검증
- 모든 API 함수는 타입 안정성을 위해 Parameters 타입 사용

## GET 요청 패턴
- 함수명은 `get` 또는 `fetch`로 시작 (예: `getPatients`, `fetchUserData`)
- useSuspenseQuery 사용을 우선적으로 고려 (성능상 이점)

```typescript
// API 호출 함수 정의
const fetchPatientsListOrSearch = async (params: Parameters<typeof apiClient.v3.apiPatientsElListOrSearch>[0]) => {
  const response = await apiClient.v3.apiPatientsElListOrSearch(params);
  return SHARED_UTILS.api.checkApiResponse(response.data);
};

// useSuspenseQuery 사용 (우선 권장)
const { data } = useSuspenseQuery({
  queryKey: [QUERY_KEY.apiPatientsElListOrSearch, params] as const,
  queryFn: ({ queryKey }) => fetchPatientsListOrSearch(queryKey[1]),
});

// useQuery 사용 (필요한 경우)
const { data, isLoading } = useQuery({
  queryKey: [QUERY_KEY.apiPatientsElListOrSearch, params] as const,
  queryFn: ({ queryKey }) => fetchPatientsListOrSearch(queryKey[1]),
});
```

## POST/PUT/DELETE 요청 패턴
- 함수명은 HTTP 메서드로 시작 (예: `postChatRoom`, `putUserInfo`, `deleteComment`)
- useMutation 사용

```typescript
// API 호출 함수 정의
export const postChatroomUpdateRead = async (
  params: Parameters<typeof apiClient.v3.apiChatroomHmUpdateRead>[0],
) => {
  const { data } = await apiClient.v3.apiChatroomHmUpdateRead(params);
  return SHARED_UTILS.api.checkApiResponse(data);
};

// useMutation 사용
const mutateSomething = useMutation({
  mutationFn: (params: Parameters<typeof postChatroomUpdateRead>[0]) => {
    return postChatroomUpdateRead(params);
  },
  onSuccess: (data) => {
    // 성공 시 처리 로직
  },
  onError: (error) => {
    // 에러 처리 로직
  },
});
```

## 커스텀 훅 패턴
- 연관된 여러 API 호출은 하나의 커스텀 훅으로 묶어서 관리
- 훅 이름은 `use`로 시작하고 도메인 이름 포함 (예: `useChatRoomMutations`, `useUserQueries`)

```typescript
export const useApiMutations = () => {
  const mutateOne = useMutation({
    mutationFn: (params) => postSomething(params),
  });

  const mutateTwo = useMutation({
    mutationFn: (params) => postSomethingElse(params),
  });

  return {
    mutateOne,
    mutateTwo,
  };
};
```

## 에러 처리
- API 호출 시 발생하는 에러는 일관되게 처리
- 사용자에게 보여줄 에러 메시지는 `onError` 콜백에서 처리
- 디버깅을 위한 로그는 console.error 사용

## 캐싱 및 무효화
- 연관된 데이터의 경우 쿼리 무효화 로직 추가
- 적절한 staleTime, cacheTime 설정으로 불필요한 API 호출 방지

